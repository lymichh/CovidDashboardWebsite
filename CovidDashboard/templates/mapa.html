{% extends "index.html" %}

{% block content %}
<div class="page-header">
    <div>
        <h1>Mapa de Calor COVID-19</h1>
        <small>Visualizaci√≥n geogr√°fica de casos por mill√≥n y tasa de mortalidad</small>
    </div>
</div>

<div class="card">
    <!-- Informaci√≥n adicional -->
    <div class="info-box">
        <h3>‚ÑπÔ∏è Informaci√≥n</h3>
        <p id="info-text">
            {% if tipo == 'CasosPorMillon' %}
                Este mapa muestra el n√∫mero de casos confirmados por cada mill√≥n de habitantes, 
                permitiendo comparar la incidencia del COVID-19 independientemente del tama√±o poblacional de cada pa√≠s.
            {% else %}
                Este mapa muestra la tasa de mortalidad (porcentaje de muertes respecto a casos confirmados), 
                lo que refleja la letalidad del virus en diferentes pa√≠ses.
            {% endif %}
        </p>
    </div>
    
    
    <!-- Selector de tipo -->
    <div class="mapa-selector">
        <label for="tipo">Visualizar:</label>
        <select id="tipo">
            <option value="CasosPorMillon" {% if tipo == 'CasosPorMillon' %}selected{% endif %}>üìä Casos por mill√≥n</option>
            <option value="TasaMortalidad" {% if tipo == 'TasaMortalidad' %}selected{% endif %}>üíÄ Tasa de mortalidad (%)</option>
        </select>
    </div>

    <!-- Contenedor del mapa -->
    <div id="mapa-container">
        {{ graph_html|safe }}
    </div>

    <div class="info-box green">
        <h3>üí° Tip de Uso</h3>
        <p>
            En este mapa de calor, los colores indican la intensidad del impacto del COVID-19 en cada pa√≠s: 
            m√°s oscuros representan valores m√°s altos. Puedes pasar el cursor por encima para ver el valor exacto. 
            Puedes usar el men√∫ desplegable para alternar entre ambas m√©tricas y comparar visualmente las regiones m√°s afectadas.
    </p>
    
</div>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    const tipoSelect = document.getElementById('tipo');
    const infoText = document.getElementById('info-text');
    
    tipoSelect.addEventListener('change', () => {
        const selectedTipo = tipoSelect.value;
        if (selectedTipo === 'CasosPorMillon') {
            infoText.textContent = 'Este mapa muestra el n√∫mero de casos confirmados por cada mill√≥n de habitantes, permitiendo comparar la incidencia del COVID-19 independientemente del tama√±o poblacional de cada pa√≠s.';
        } else {
            infoText.textContent = 'Este mapa muestra la tasa de mortalidad (porcentaje de muertes respecto a casos confirmados), lo que refleja la letalidad del virus en diferentes pa√≠ses.';
        }
        window.location.href = `/mapa?tipo=${selectedTipo}`;
    });
</script>
{% endblock %}