{% extends "index.html" %}

{% block content %}
<div class="page-header">
    <div>
        <h1>Mapa de Calor COVID-19</h1>
        <small>Visualizaci贸n geogr谩fica de casos por mill贸n y tasa de mortalidad</small>
    </div>
</div>

<div class="card">
    <!-- Selector de tipo -->
    <div class="mapa-selector">
        <label for="tipo">Visualizar:</label>
        <select id="tipo">
            <option value="CasosPorMillon" {% if tipo == 'CasosPorMillon' %}selected{% endif %}> Casos por mill贸n</option>
            <option value="TasaMortalidad" {% if tipo == 'TasaMortalidad' %}selected{% endif %}> Tasa de mortalidad (%)</option>
        </select>
    </div>

    <!-- Contenedor del mapa -->
    <div id="mapa-container">
        {{ graph_html|safe }}
    </div>

    <!-- Informaci贸n adicional -->
    <div class="info-box">
        <h3>癸 Informaci贸n</h3>
        <p id="info-text">
            {% if tipo == 'CasosPorMillon' %}
                Este mapa muestra el n煤mero de casos confirmados por cada mill贸n de habitantes, 
                permitiendo comparar la incidencia del COVID-19 independientemente del tama帽o poblacional de cada pa铆s.
            {% else %}
                Este mapa muestra la tasa de mortalidad (porcentaje de muertes respecto a casos confirmados), 
                lo que refleja la letalidad del virus en diferentes pa铆ses.
            {% endif %}
        </p>
    </div>
</div>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    const tipoSelect = document.getElementById('tipo');
    const infoText = document.getElementById('info-text');
    
    tipoSelect.addEventListener('change', () => {
        const selectedTipo = tipoSelect.value;
        if (selectedTipo === 'CasosPorMillon') {
            infoText.textContent = 'Este mapa muestra el n煤mero de casos confirmados por cada mill贸n de habitantes, permitiendo comparar la incidencia del COVID-19 independientemente del tama帽o poblacional de cada pa铆s.';
        } else {
            infoText.textContent = 'Este mapa muestra la tasa de mortalidad (porcentaje de muertes respecto a casos confirmados), lo que refleja la letalidad del virus en diferentes pa铆ses.';
        }
        window.location.href = `/mapa?tipo=${selectedTipo}`;
    });
</script>
{% endblock %}